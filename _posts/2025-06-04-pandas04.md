---
title: "Pandas 실습 Part 5"
date: 2025-06-04
author: "정우민"
layout: post
categories : pandas
tags: [pandas, python, data-analysis, tutorial]
summary: "Pandas의 concat, merge, 정규화 방법을 예제 중심으로 실습하며 알아봅니다."
---

# concat, merge, 정규화

Pandas를 활용한 데이터 분석에서 여러 DataFrame을 합치거나, 데이터를 정규화해야 하는 경우는 매우 빈번하게 발생합니다. 이 포스트에서는 `concat`, `merge`, 그리고 정규화(normalization)와 관련된 실습을 예제로 정리합니다.

---

## 1. concat : DataFrame을 단순하게 연결하기

`pd.concat()` 함수는 여러 개의 DataFrame을 **수직 또는 수평**으로 이어붙일 때 사용합니다.

### 수직 연결 (기본 설정)
```python
row_concat = pd.concat([df1, df2, df3])
```

## 인덱스를 무시하고 연결
```python
row_concat_index = pd.concat([df1, df2, df3], ignore_index=True)
```

## 시리즈를 행으로 추가할 때

```python
new_row_series = pd.Series(['n1', 'n2', 'n3', 'n4'])
pd.concat([df1, new_row_series])
```

시리즈는 열 이름이 없기 때문에 보통 DataFrame으로 만들어 추가합니다.

```python
new_row_df = pd.DataFrame([['n1', 'n2', 'n3', 'n4']], columns=['A', 'B', 'C', 'D'])
pd.concat([df1, new_row_df])
```

## 열 방향으로 연결

```python
col_concat = pd.concat([df1, df2, df3], axis="columns")
```

## 2. merge: SQL 스타일 조인
`pd.merge()` 함수는 두 DataFrame을 **공통된 열(column)**을 기준으로 병합할 수 있습니다. 마치 SQL의 `JOIN`처럼 동작합니다.

```python
merged_df = pd.merge(site, visited, left_on='name', right_on='site')
```

## 다양한 조인 방식

| how   | 설명           |
| ----- | ------------ |
| inner | 양쪽 모두에 있는 값만 |
| outer | 양쪽 모두 포함     |
| left  | 왼쪽 기준 전체     |
| right | 오른쪽 기준 전체    |


```python
pd.merge(person, survey, left_on='ident', right_on='person', how='outer')
```

## 3. 데이터 정규화: Billboard 차트 데이터를 예제로

이번에는 Billboard 차트 데이터를 예제로 사용하여 **정규화(Normalization)** 과정을 Pandas로 구현해보겠습니다. 정규화는 중복된 정보를 별도의 테이블로 분리해 **데이터 중복을 줄이고 관리 효율성을 높이는 기법**입니다.

---

## 🔹 원본 데이터 구조 (billboard_long)

`billboard_long` 데이터는 아래와 같은 형식으로, 각 곡의 주차별 순위 정보를 모두 포함하고 있습니다.

```python
billboard = pd.read_csv('../data/billboard.csv')

billboard_long = billboard.melt(
    id_vars = ["year", "artist", "track", "time", "date.entered"],
    var_name = "week",
    value_name = "rating",
)
billboard_long
```
| year | artist          | track             | time | date.entered | week      | rating |
| ---- | --------------- | ----------------- | ---- | ------------ | --------- | ------ |
| 2000 | 2 Pac           | Baby Don't Cry... | 4:22 | 2000-02-26   | wk1       | 87.0   |
| 2000 | 2Ge+her         | The Hardest Pa... | 3:15 | 2000-09-02   | wk1       | 91.0   |
| ...  | ...             | ...               | ...  | ...          | ...       | ...    |


곡 정보가 중복되어 여러 번 등장하고 있어 관리가 비효율적입니다.

### 🔹 Step 1. 곡 정보 추출 및 중복 제거
우선 곡별 정보를 따로 분리합니다.

```python
billboard_songs = billboard_long[["year", "artist", "track", "date.entered"]]
billboard_songs = billboard_songs.drop_duplicates()
```

### 🔹 Step 2. 고유 ID 부여
각 곡에 고유 ID를 부여하여 이후 데이터와 연결할 수 있도록 합니다.

```python
billboard_songs['id'] = billboard_songs.index + 1
```

이제 billboard_songs는 다음과 같은 구조를 가집니다.

| year | artist          | track                  | date.entered | id  |
| ---- | --------------- | ---------------------- | ------------ | --- |
| 2000 | 2 Pac           | Baby Don't Cry Keep... | 2000-02-26   | 1   |
| 2000 | 2Ge+her         | The Hardest Part Of... | 2000-09-02   | 2   |
| ...  | ...             | ...                    | ...          | ... |

### 🔹 Step 3. 정규화된 데이터 결합
곡별 고유 ID를 기준으로 billboard_long과 다시 연결합니다.

```python
billboard_ratings = billboard_long.merge(
    billboard_songs,
    on=["year", "artist", "track", "date.entered"]
)
```

이제 중복되는 곡 정보 대신 ID로 연결됩니다.

### 🔹 Step 4. 정리된 테이블 구성
곡 ID, 주차 정보, 차트 순위만 남겨 최종 테이블을 구성합니다.

```python
billboard_ratings = billboard_ratings[["id", "week", "rating"]]
```

최종적으로 billboard_ratings는 다음과 같은 형식을 갖습니다.

| id  | week | rating |
| --- | ---- | ------ |
| 1   | wk1  | 87.0   |
| 2   | wk1  | 91.0   |
| 3   | wk1  | 81.0   |
| ... | ...  | ...    |


✅ 요약
이처럼 데이터를 정규화하면:

중복 제거로 데이터 용량을 줄일 수 있고,

곡 정보와 순위 정보가 명확히 분리되어 가독성과 유지보수성이 향상됩니다.

이 방식은 데이터베이스의 정규화 원칙과도 유사하며, Pandas에서도 쉽게 구현할 수 있습니다.

## 마무리
이번 실습에서는 Pandas에서 많이 쓰이는 세 가지 기능—concat, merge, 정규화—를 다뤄봤습니다. 실무에서는 다양한 형태의 데이터를 합치거나 병합하거나, 전처리할 일이 많기 때문에 이 기능들을 잘 익혀두면 큰 도움이 됩니다.

📌 다음 편에서는 groupby, pivot_table 등 집계와 변형에 관한 내용을 다룰 예정입니다.
